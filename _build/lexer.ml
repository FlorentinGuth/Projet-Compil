# 1 "lexer.mll"
 
open Utils
open Parser
open Lexing
open Printer
open Format


let error lexbuf s = raise (Lexing_error (s, (lexeme_start_p lexbuf,
                                              lexeme_end_p   lexbuf)))

let reserved = assoc_to_hashtbl
                 [("access",        ACCESS);
                  ("all",           ALL);
                  ("and",           AND);
                  ("begin",         BEGIN);
                  ("else",          ELSE);
                  ("elsif",         ELSIF);
                  ("end",           END);
                  ("false",         BOOL false);
                  ("for",           FOR);
                  ("function",      FUNC);
                  ("if",            IF);
                  ("in",            IN);
                  ("is",            IS);
                  ("loop",          LOOP);
                  ("new",           NEW);
                  ("not",           NOT);
                  ("null",          NULL);
                  ("or",            OR);
                  ("out",           OUT);
                  ("procedure",     PROC);
                  ("record",        RECORD);
                  ("rem",           REM);
                  ("return",        RETURN);
                  ("reverse",       REVERSE);
                  ("then",          THEN);
                  ("true",          BOOL true);
                  ("type",          TYPE);
                  ("use",           USE);
                  ("while",         WHILE);
                  ("with",          WITH);
                 ]

let to_token s =
  let s' = String.lowercase_ascii s in
  try
    Hashtbl.find reserved s'
  with
  | Not_found -> IDENT s'

let to_int lexbuf s =
  try
    let n = int_of_string s in
    assert (n <= 1 lsl 31);
    INT n
  with
  | Failure _ | Assert_failure _ ->
    error lexbuf (sprintf "Integer too big: %s" s)

# 63 "lexer.ml"
let __ocaml_lex_tables = {
  Lexing.lex_base = 
   "\000\000\229\255\230\255\231\255\232\255\017\000\003\000\238\255\
    \239\255\241\255\243\255\030\000\031\000\032\000\249\255\123\000\
    \209\000\219\000\049\000\001\000\254\255\255\255\253\255\056\000\
    \250\255\248\255\246\255\244\255\236\255\234\255\021\000\253\255\
    \254\255\002\000\255\255";
  Lexing.lex_backtrk = 
   "\255\255\255\255\255\255\255\255\255\255\020\000\018\000\255\255\
    \255\255\255\255\255\255\010\000\008\000\015\000\255\255\022\000\
    \004\000\003\000\013\000\026\000\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\002\000\255\255";
  Lexing.lex_default = 
   "\001\000\000\000\000\000\000\000\000\000\255\255\255\255\000\000\
    \000\000\000\000\000\000\255\255\255\255\255\255\000\000\255\255\
    \255\255\255\255\255\255\255\255\000\000\000\000\000\000\255\255\
    \000\000\000\000\000\000\000\000\000\000\000\000\031\000\000\000\
    \000\000\255\255\000\000";
  Lexing.lex_trans = 
   "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\021\000\020\000\020\000\034\000\019\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\034\000\
    \021\000\000\000\033\000\000\000\000\000\000\000\000\000\015\000\
    \004\000\003\000\009\000\010\000\008\000\018\000\005\000\013\000\
    \016\000\016\000\016\000\016\000\016\000\016\000\016\000\016\000\
    \016\000\016\000\006\000\007\000\012\000\014\000\011\000\029\000\
    \028\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\027\000\026\000\025\000\022\000\024\000\
    \000\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\023\000\023\000\023\000\023\000\023\000\
    \023\000\023\000\023\000\000\000\000\000\000\000\000\000\000\000\
    \002\000\016\000\016\000\016\000\016\000\016\000\016\000\016\000\
    \016\000\016\000\016\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\032\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\000\000\000\000\
    \000\000\000\000\017\000\000\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000";
  Lexing.lex_check = 
   "\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\000\000\000\000\019\000\033\000\000\000\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\030\000\
    \000\000\255\255\030\000\255\255\255\255\255\255\255\255\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\005\000\
    \006\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\011\000\012\000\013\000\018\000\023\000\
    \255\255\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\015\000\015\000\015\000\015\000\015\000\
    \015\000\015\000\015\000\255\255\255\255\255\255\255\255\255\255\
    \000\000\016\000\016\000\016\000\016\000\016\000\016\000\016\000\
    \016\000\016\000\016\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\030\000\255\255\255\255\
    \255\255\255\255\255\255\255\255\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\255\255\255\255\
    \255\255\255\255\017\000\255\255\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\017\000\017\000\
    \017\000\017\000\017\000\017\000\017\000\017\000\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255";
  Lexing.lex_base_code = 
   "";
  Lexing.lex_backtrk_code = 
   "";
  Lexing.lex_default_code = 
   "";
  Lexing.lex_trans_code = 
   "";
  Lexing.lex_check_code = 
   "";
  Lexing.lex_code = 
   "";
}

let rec token lexbuf =
    __ocaml_lex_token_rec lexbuf 0
and __ocaml_lex_token_rec lexbuf __ocaml_lex_state =
  match Lexing.engine __ocaml_lex_tables __ocaml_lex_state lexbuf with
      | 0 ->
# 77 "lexer.mll"
                            ( token lexbuf )
# 226 "lexer.ml"

  | 1 ->
# 78 "lexer.mll"
                            ( new_line lexbuf; token lexbuf )
# 231 "lexer.ml"

  | 2 ->
# 79 "lexer.mll"
                            ( comment lexbuf )
# 236 "lexer.ml"

  | 3 ->
let
# 80 "lexer.mll"
             s
# 242 "lexer.ml"
= Lexing.sub_lexeme lexbuf lexbuf.Lexing.lex_start_pos lexbuf.Lexing.lex_curr_pos in
# 80 "lexer.mll"
                            ( to_token s )
# 246 "lexer.ml"

  | 4 ->
let
# 81 "lexer.mll"
               n
# 252 "lexer.ml"
= Lexing.sub_lexeme lexbuf lexbuf.Lexing.lex_start_pos lexbuf.Lexing.lex_curr_pos in
# 81 "lexer.mll"
                            ( to_int lexbuf n )
# 256 "lexer.ml"

  | 5 ->
let
# 82 "lexer.mll"
                   c
# 262 "lexer.ml"
= Lexing.sub_lexeme_char lexbuf (lexbuf.Lexing.lex_start_pos + 1) in
# 82 "lexer.mll"
                            ( CHAR c )
# 266 "lexer.ml"

  | 6 ->
# 83 "lexer.mll"
         ( EQ )
# 271 "lexer.ml"

  | 7 ->
# 84 "lexer.mll"
         ( NEQ )
# 276 "lexer.ml"

  | 8 ->
# 85 "lexer.mll"
         ( LT )
# 281 "lexer.ml"

  | 9 ->
# 86 "lexer.mll"
         ( LEQ )
# 286 "lexer.ml"

  | 10 ->
# 87 "lexer.mll"
         ( GT )
# 291 "lexer.ml"

  | 11 ->
# 88 "lexer.mll"
         ( GEQ )
# 296 "lexer.ml"

  | 12 ->
# 89 "lexer.mll"
         ( PLUS )
# 301 "lexer.ml"

  | 13 ->
# 90 "lexer.mll"
         ( MINUS )
# 306 "lexer.ml"

  | 14 ->
# 91 "lexer.mll"
         ( TIMES )
# 311 "lexer.ml"

  | 15 ->
# 92 "lexer.mll"
         ( DIV )
# 316 "lexer.ml"

  | 16 ->
# 93 "lexer.mll"
         ( COMMA )
# 321 "lexer.ml"

  | 17 ->
# 94 "lexer.mll"
         ( SEMICOLON )
# 326 "lexer.ml"

  | 18 ->
# 95 "lexer.mll"
         ( COLON )
# 331 "lexer.ml"

  | 19 ->
# 96 "lexer.mll"
         ( AFFECT )
# 336 "lexer.ml"

  | 20 ->
# 97 "lexer.mll"
         ( DOT )
# 341 "lexer.ml"

  | 21 ->
# 98 "lexer.mll"
         ( DOTDOT )
# 346 "lexer.ml"

  | 22 ->
# 99 "lexer.mll"
         ( QUOTE )
# 351 "lexer.ml"

  | 23 ->
# 100 "lexer.mll"
         ( LPAREN )
# 356 "lexer.ml"

  | 24 ->
# 101 "lexer.mll"
         ( RPAREN )
# 361 "lexer.ml"

  | 25 ->
# 102 "lexer.mll"
         ( EOF )
# 366 "lexer.ml"

  | 26 ->
let
# 103 "lexer.mll"
         c
# 372 "lexer.ml"
= Lexing.sub_lexeme_char lexbuf lexbuf.Lexing.lex_start_pos in
# 103 "lexer.mll"
           ( error lexbuf (sprintf "Unknown character %c" c) )
# 376 "lexer.ml"

  | __ocaml_lex_state -> lexbuf.Lexing.refill_buff lexbuf; 
      __ocaml_lex_token_rec lexbuf __ocaml_lex_state

and comment lexbuf =
    __ocaml_lex_comment_rec lexbuf 30
and __ocaml_lex_comment_rec lexbuf __ocaml_lex_state =
  match Lexing.engine __ocaml_lex_tables __ocaml_lex_state lexbuf with
      | 0 ->
# 106 "lexer.mll"
                 ( new_line lexbuf; token lexbuf )
# 388 "lexer.ml"

  | 1 ->
# 107 "lexer.mll"
                 ( EOF )
# 393 "lexer.ml"

  | 2 ->
# 108 "lexer.mll"
                 ( comment lexbuf )
# 398 "lexer.ml"

  | __ocaml_lex_state -> lexbuf.Lexing.refill_buff lexbuf; 
      __ocaml_lex_comment_rec lexbuf __ocaml_lex_state

;;

# 111 "lexer.mll"
 
  (** Tokens printer *)
  
  let print_token fmt = function
    | WITH        -> fprintf fmt "WITH"
    | USE         -> fprintf fmt "USE"
    | PROC        -> fprintf fmt "PROC"
    | FUNC        -> fprintf fmt "FUNC"
    | RETURN      -> fprintf fmt "RETURN"
    | IS          -> fprintf fmt "IS"
    | BEGIN       -> fprintf fmt "BEGIN"
    | END         -> fprintf fmt "END"
    | TYPE        -> fprintf fmt "TYPE"
    | ACCESS      -> fprintf fmt "ACCESS"
    | RECORD      -> fprintf fmt "RECORD"
    | ALL         -> fprintf fmt "ALL"
    | INT n       -> fprintf fmt "@[INT %d@]" n
    | CHAR c      -> fprintf fmt "@[CHAR %c@]" c
    | BOOL b      -> fprintf fmt "@[BOOL %b@]" b
    | NULL        -> fprintf fmt "NULL"
    | IDENT s     -> fprintf fmt "%s" s
    | OR          -> fprintf fmt "OR"
    | OR_ELSE     -> fprintf fmt "OR_ELSE"
    | AND         -> fprintf fmt "AND"
    | AND_THEN    -> fprintf fmt "AND_THEN"
    | NOT         -> fprintf fmt "NOT"
    | EQ          -> fprintf fmt "="
    | NEQ         -> fprintf fmt "/="
    | GT          -> fprintf fmt ">"
    | GEQ         -> fprintf fmt ">="
    | LT          -> fprintf fmt "<"
    | LEQ         -> fprintf fmt "<="
    | PLUS        -> fprintf fmt "+"
    | MINUS       -> fprintf fmt "-"
    | TIMES       -> fprintf fmt "*"
    | DIV         -> fprintf fmt "/"
    | REM         -> fprintf fmt "%%"
    | UNARY_MINUS -> fprintf fmt "-"
    | NEW         -> fprintf fmt "NEW"
    | IF          -> fprintf fmt "IF"
    | THEN        -> fprintf fmt "THEN"
    | ELSIF       -> fprintf fmt "ELSIF"
    | ELSE        -> fprintf fmt "ELSE"
    | WHILE       -> fprintf fmt "WHILE"
    | FOR         -> fprintf fmt "FOR"
    | REVERSE     -> fprintf fmt "REVERSE"
    | LOOP        -> fprintf fmt "LOOP"
    | COMMA       -> fprintf fmt ","
    | SEMICOLON   -> fprintf fmt ";"
    | COLON       -> fprintf fmt ":"
    | AFFECT      -> fprintf fmt ":="
    | DOT         -> fprintf fmt "."
    | DOTDOT      -> fprintf fmt ".."
    | QUOTE       -> fprintf fmt "'"
    | LPAREN      -> fprintf fmt "("
    | RPAREN      -> fprintf fmt ")"
    | IN          -> fprintf fmt "IN"
    | OUT         -> fprintf fmt "OUT"
    | EOF         -> fprintf fmt "EOF"
                       
  let print_token_list fmt l =
    print_list (print_sep " ") print_token fmt l;
    pp_print_flush fmt ()

# 470 "lexer.ml"
